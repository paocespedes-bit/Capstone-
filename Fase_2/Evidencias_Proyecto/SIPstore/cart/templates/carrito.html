{% extends "base.html" %}
{% load static %}
{% load myfilters %}
{% block link %}
<link rel="stylesheet" href="{% static 'cart/css/carrito.css' %}" />
{% endblock %}

{% block title %}Carrito de Compras{% endblock %}

{% block content %}
<div class="container cart-container">
  <div class="row">
    <!-- Lista de productos -->
    {% if carrito %}
    <div class="col-md-8">
      <div class="titulo">
        <h1>Carrito</h1>
      </div>
      <!-- Producto -->

      {% for p in productos %}
      <div class="cart-item d-flex align-items-center">
        <img src="{% static 'img/SinImagen.png' %}" alt="Producto">
        <div class="ms-3 flex-grow-1">
          <h5>{{ p.nombre }}</h5>
          {% if p.tipo == "kitconstruccion" %}
          <p>Kit ID: {{ p.id }}</p>
          {% elif p.tipo == "panelsip" %}
          <p>Panel ID: {{ p.id }}</p>
          {% else %}
          <p>ID: {{ p.id }}</p>
          {% endif %}
        </div>
        <div class="me-3">
          <input type="number" class="form-control quantity-input" value="{{ p.cantidad }}" min="1" step="1"
            data-contenttype="{{ p.tipo }}" data-id="{{ p.id }}">
        </div>
        <div class="text-end">
          <p class="mb-1">${{ p.precio|floatformat:0|punto_miles }}
            <!-- <span class="price-original">${{ p.precio_anterior|floatformat:0|punto_miles }}</span> --> </p>
        </div>
        <div>
          <button class="remove-cart-item btn btn-danger m-3" data-id="{{ p.id }}" data-contenttype="{{ p.tipo }}"><i class="bi bi-trash"></i> Eliminar</button> 
        </div>
      </div>
      {% endfor %}
      <div>
        <a class="btn btn-danger m-3" href="{% url 'vaciar_carrito' %}">Vaciar Carro</a>
      </div>

    </div>
    <!-- Resumen de compra -->
    <div class="col-md-4">
      <div class="cart-summary">
        <h4>Resumen de Compra</h4>
        {% for p in productos %}
        <div class="d-flex justify-content-between">
          <span>{{p.nombre|truncatechars:10}} x {{p.cantidad}}</span>
          <strong>${{p.subtotal}}</strong>
        </div>
        {% endfor %}
        <hr>
        <div class="d-flex justify-content-between total">
          <span>Total</span>
          <span>${{total|floatformat:0|punto_miles}}</span>
        </div>
        <button class="btn btn-primary w-100 mt-3">Continuar Compra</button>
      </div>
      <ul>
        {% for item in carrito %}
        <li>
          Tipo: {{ item.content_type }}, ID: {{ item.product_id }}, Cantidad: {{ item.quantity }}
        </li>
        {% endfor %}
      </ul>

    </div>
    {% else %}
    <p>El carrito está vacío</p>
    {% endif %}
  </div>
</div>

{% endblock %}

{% block script %}
<script src="{% static 'eliminar_carrito.js' %}"></script>
{% endblock %}