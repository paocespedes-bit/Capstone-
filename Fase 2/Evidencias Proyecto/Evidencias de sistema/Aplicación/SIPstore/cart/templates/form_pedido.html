{% load static %}

<div class="collapse" id="checkoutFormCollapse">
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">Información de Pedido y Cliente</h5>
        </div>
        <div class="card-body">
            <form id="pedidoForm" method="POST" action="{% url 'crear_pedido' %}">
                {% csrf_token %}
                <fieldset class="mb-4 p-3 border rounded">
                    <legend class="float-none w-auto px-2 fs-6 text-success">Información Pedido</legend>

                    <div class="mb-3">
                        <label for="localSelect" class="form-label">Local de Retiro</label>
                        <select name="localSelect" class="form-select" id="localSelect"
                            onchange="showLocalCard(this.value)" required>
                            <option value="" selected disabled>Selecciona un local...</option>
                            {% for local in locales %}
                            <option value="{{ local.id }}" data-nombre="{{ local.nombre }}"
                                data-ubicacion="{{ local.ubicacion }}">
                                {{ local.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="card text-bg-light mb-3 d-none" id="localCard">
                        <div class="card-body">
                            <h6 class="card-title" id="localCardName"></h6>
                            <p class="card-text" id="localCardAddress"></p>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="mb-4 p-3 border rounded">
                    <legend class="float-none w-auto px-2 fs-6 text-success">Método de Pago</legend>

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="paymentOnline"
                            value="online" required checked>
                        <label class="form-check-label" for="paymentOnline">
                            <strong class="text-primary">Pago en línea</strong> (Paga ahora con tarjeta de
                            crédito/débito)
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="paymentStore"
                            value="store" required {% if contiene_kit %}disabled{% endif %}>

                        <label class="form-check-label" for="paymentStore">
                            <strong class="text-secondary">Pago en tienda</strong> (Paga al momento de retirar)

                            <br>

                            <!-- Este div SIEMPRE existe -->
                            <div id="bloqueoPagoTienda" style="display: none;">
                                <p class="text-danger fw-bold" style="font-size: small;">
                                    No disponible porque tu carrito incluye un Kit de Autoconstrucción o Viene de Cotizador
                                </p>
                            </div>
                        </label>
                    </div>


                </fieldset>
                <fieldset class="p-3 border rounded">
                    <legend class="float-none w-auto px-2 fs-6 text-success">Información Cliente (para boleta)</legend>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="clientName" class="form-label">Nombre Cliente</label>
                            <input type="text" class="form-control" id="clientName" name="clientName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="clientRut" class="form-label">RUT</label>
                            <input type="text" class="form-control" id="clientRut" name="clientRut" required
                                placeholder="Ej: 12.345.678-9">
                        </div>
                        <div class="col-md-6">
                            <label for="clientEmail" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="clientEmail" name="clientEmail" required>
                        </div>
                        <div class="col-md-6">
                            <label for="clientPhone" class="form-label">Celular de Contacto</label>
                            <input type="tel" class="form-control" id="clientPhone" name="clientPhone" required>
                        </div>
                        <div class="col-12">
                            <label for="clientAddress" class="form-label">Ubicación (para boleta)</label>
                            <input type="text" class="form-control" id="clientAddress" name="clientAddress" required
                                placeholder="Calle, número, comuna/ciudad">
                            <div class="form-text">Ubicación solo para fines de boleta/facturación.</div>
                        </div>
                    </div>
                </fieldset>
                <fieldset class="p-3 border rounded mt-4">
                    <legend class="float-none w-auto px-2 fs-6 text-primary">Información de Retiro</legend>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Fecha de Compra</label>
                            <input type="text" class="form-control" value="{{ fecha_pedido }}" readonly>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Fecha Estimada de Retiro</label>
                            <input type="text" class="form-control text-success fw-bold" value="{{ fecha_retiro }}"
                                readonly>
                            <div class="form-text">Tu pedido estará disponible para retiro en 5 días.</div>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const contieneKit = {{ contiene_kit|yesno:"true,false" }};
        const divBloqueo = document.getElementById("bloqueoPagoTienda");
        const inputPagoTienda = document.getElementById("paymentStore");

        if (contieneKit) {
            inputPagoTienda.disabled = true;   // desactiva el método
            divBloqueo.style.display = "block"; // muestra el mensaje
        }
    });
</script>