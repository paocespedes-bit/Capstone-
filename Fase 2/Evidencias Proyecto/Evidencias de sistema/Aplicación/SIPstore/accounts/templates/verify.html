{% extends "base_accounts.html" %}
{% load static %}

{% block link %}
<script>
    document.addEventListener("DOMContentLoaded", function(){
      var remaining = parseInt("{{ remaining|default:'0' }}");
      var display = document.getElementById('time');
      var resendBtn = document.getElementById('resendBtn');
      function start(t){
        var timer = t;
        resendBtn.disabled = true;
        var iv = setInterval(function(){
          var m = Math.floor(timer/60);
          var s = timer % 60;
          display.textContent = (m<10?"0"+m:m)+":"+(s<10?"0"+s:s);
          timer--;
          if(timer < 0){
            clearInterval(iv);
            display.textContent = "Expirado";
            resendBtn.disabled = false;
          }
        }, 1000);
      }
      if(remaining > 0) start(remaining);
      else display.textContent = "Expirado";
    });
  </script>

{% endblock %}

{% block title %}Ingresar código{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card p-3 shadow-sm">
        <h4>Ingresar código</h4>
        <p>El código se envió a: <strong>{{ dest_masked }}</strong></p>
        <p>Tiempo restante: <span id="time">--:--</span></p>
        <form method="post" novalidate>
          {% csrf_token %}
          <div class="mb-3">
            {{ form.code.label_tag }}
            {{ form.code }}
          </div>
          <div class="d-flex justify-content-between">
            <a class="btn btn-secondary" href="{% url 'forgot' %}">Volver</a>
            <div>
              <button formaction="{% url 'resend' %}" class="btn btn-outline-primary" id="resendBtn">Reenviar código</button>
              <button class="btn btn-primary">Validar código</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block script %}

{% endblock %}