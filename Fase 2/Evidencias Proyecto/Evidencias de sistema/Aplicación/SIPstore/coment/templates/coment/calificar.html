{% extends "base.html" %} {% load static %} {% block title %}Calificar {{
producto.nombre }}{% endblock %} {% block link %}
<link rel="stylesheet" href="{% static 'css/calificar.css' %}" />
{% endblock %} {% block content %}
<div class="cont">
  <div class="rating-container">
    <div class="product-header">
      {% if producto.imagenes.all %}
      <img
        src="{{ producto.imagenes.first.imagen.url }}"
        alt="{{ producto.nombre }}"
      />
      {% endif %}
      <h2 class="mt-3">{{ producto.nombre }}</h2>
    </div>

    {% if promedio %}
    <div class="average-rating">⭐ Promedio: {{ promedio }}/5</div>
    {% endif %}

    <form method="post">
      {% csrf_token %}
      <div class="rating-stars">
        {% for i in "54321" %}
        <input type="radio" id="star{{ i }}" name="estrellas" value="{{ i }}" />
        <label for="star{{ i }}">★</label>
        {% endfor %}
      </div>

      <div class="mb-3">
        <textarea
          name="comentario"
          class="form-control"
          rows="4"
          placeholder="Escribe tu comentario aquí..."
        ></textarea>
      </div>

      <div class="text-center">
        <button type="submit" class="btn-submit">Enviar calificación</button>
      </div>
    </form>

    {% if calificaciones %}
    <h4 class="text-center mb-4" style="margin-top: 40px;">Opiniones de otros usuarios</h4>
    <div class="comentarios-container mt-5">

      {% for cal in calificaciones %}
      <div class="comentario-card">
        <div class="comentario-header">
          <strong>
            {% if cal.usuario %} {{ cal.usuario.username }} {% else %} Anónimo
            {% endif %}
          </strong>
          <span class="comentario-fecha"
            >{{ cal.fecha_creacion|date:"d/m/Y H:i" }}</span
          >
        </div>

        <div class="comentario-estrellas">
          {% for i in "12345" %} {% if forloop.counter <= cal.estrellas %}
          <span class="estrella llena">★</span>
          {% else %}
          <span class="estrella vacia">★</span>
          {% endif %} {% endfor %}
        </div>

        <p class="comentario-texto">{{ cal.comentario }}</p>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-center mt-4 text-muted">
      Aún no hay comentarios para este producto.
    </p>
    {% endif %}

    <div class="text-center mt-3">
      <a
        href="javascript:history.back()"
        class="btn btn-outline-secondary btn-sm"
        >← Volver</a
      >
    </div>
  </div>
</div>
{% endblock %}
